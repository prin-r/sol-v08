import brownie


def test_bridge_relayBlock_success(simplebridge):
    simplebridge.relayBlock(
        [
            "0x94FE4A060FCF744C5BFCE1155CF1AB99B386F9170BC1C0105060994AEBEDE65C",
            "0x81A0E5D8922FA8C8FE948D9B4D5698FEFA77E52FB8DF370AE274C43230B4D669",
            "0x7920D562EC07A9979286FDCDA975F943D41D31974B01B8DC5B1B374878B194DA",
            "0xB1AA552EFF4C5CEDE334037AC62520E89AA76FA4326A4C56E9A92996C0BF7E26",
            "0x739AA168868729CA2139B3AC5A066BDEB8BF06A059C2FE35E9D7D65504E26F55",
        ],
        [
            "0x3F02642D9E70D5C1C493A4F732BFE9C9B95A4A42651703B816EDCFC8FADA5312",  # versionAndChainIdHash
            3418,  # height
            1622115652,  # timeSecond
            146102103,  # timeNanoSecond
            "0xE5A87E02ABE1B519CE5C57E8E35F033F5E707D368C6DF352EADFEB41FE69E3B2",  # lastBlockIDAndOther
            "0x6206F2FFDFBB93B83BD917B05B13CA59C12330268611242F5FD5734E67307915",  # nextValidatorHashAndConsensusHash
            "0x9FB9C7533CAF1D218DA3AF6D277F6B101C42E3C3B75D784242DA663604DD53C2",  # lastResultsHash
            "0x8A153906A4AFDFBF3AEA3F0AA4C4002A7F1B9FB0970200F828C8799DF424B00C",  # evidenceAndProposerHash
        ],
        [
            [
                "0x9B27A5994109DC23F315FFB58B1B37E1FBAD2DD675F580073956581AD029446C",
                "0x042811200893728CF01A56CCFE68F71284F54C973DFE5734EC554760B19DEDB4",
                27,
                "0x6E0802115A0D00000000000022480A20",
                "0x122408011220DDC9D747EC2D522D6368E7C1BB8F2DCFCA46B739E2EB60D465068E1F4816948A2A0C08C58ABE850610D58E9DDA03320962616E64636861696E",
            ],
            [
                "0x43859A093DF6E5E786FF2E1A7D42B5454512E79DDAAB674E2EAE40649B0309D6",
                "0x0D67C785A5695106B91A38974B1F7BC0AE0954F18C12A5AB184625A23E38D3AE",
                27,
                "0x6D0802115A0D00000000000022480A20",
                "0x122408011220DDC9D747EC2D522D6368E7C1BB8F2DCFCA46B739E2EB60D465068E1F4816948A2A0B08C68ABE850610E58EC501320962616E64636861696E",
            ],
            [
                "0x166EB606586E9D932A468F52545A66882DCBF751D974D369FCD058D5B87D2C2F",
                "0x02051DFCE46A45188E4042B007E0F6A9C265F3AAFDAA35F6EBB7586B0BB395C7",
                27,
                "0x6D0802115A0D00000000000022480A20",
                "0x122408011220DDC9D747EC2D522D6368E7C1BB8F2DCFCA46B739E2EB60D465068E1F4816948A2A0B08C68ABE850610CAE7FA02320962616E64636861696E",
            ],
            [
                "0xDE2B93A4D1CD495ADD00C9E8D1A9BA5FB8D00D335C58254578D730E57DEF3E01",
                "0x71A7BFBCDEECAB7E12BB8BACF50208AF78979F7BFD7F297F404E19842582E448",
                27,
                "0x6D0802115A0D00000000000022480A20",
                "0x122408011220DDC9D747EC2D522D6368E7C1BB8F2DCFCA46B739E2EB60D465068E1F4816948A2A0B08C68ABE850610A1DE9202320962616E64636861696E",
            ],
        ],
    )


def test_bridge_relayBlock_insufficient_validator(simplebridge):
    with brownie.reverts("INSUFFICIENT_VALIDATOR_SIGNATURES"):
        tx = simplebridge.relayBlock(
            [
                "0x94FE4A060FCF744C5BFCE1155CF1AB99B386F9170BC1C0105060994AEBEDE65C",
                "0x81A0E5D8922FA8C8FE948D9B4D5698FEFA77E52FB8DF370AE274C43230B4D669",
                "0x7920D562EC07A9979286FDCDA975F943D41D31974B01B8DC5B1B374878B194DA",
                "0xB1AA552EFF4C5CEDE334037AC62520E89AA76FA4326A4C56E9A92996C0BF7E26",
                "0x739AA168868729CA2139B3AC5A066BDEB8BF06A059C2FE35E9D7D65504E26F55",
            ],
            [
                "0x3F02642D9E70D5C1C493A4F732BFE9C9B95A4A42651703B816EDCFC8FADA5312",  # versionAndChainIdHash
                3418,  # height
                1622115652,  # timeSecond
                146102103,  # timeNanoSecond
                "0xE5A87E02ABE1B519CE5C57E8E35F033F5E707D368C6DF352EADFEB41FE69E3B2",  # lastBlockIDAndOther
                "0x6206F2FFDFBB93B83BD917B05B13CA59C12330268611242F5FD5734E67307915",  # nextValidatorHashAndConsensusHash
                "0x9FB9C7533CAF1D218DA3AF6D277F6B101C42E3C3B75D784242DA663604DD53C2",  # lastResultsHash
                "0x8A153906A4AFDFBF3AEA3F0AA4C4002A7F1B9FB0970200F828C8799DF424B00C",  # evidenceAndProposerHash
            ],
            [
                [
                    "0x9B27A5994109DC23F315FFB58B1B37E1FBAD2DD675F580073956581AD029446C",
                    "0x042811200893728CF01A56CCFE68F71284F54C973DFE5734EC554760B19DEDB4",
                    27,
                    "0x6E0802115A0D00000000000022480A20",
                    "0x122408011220DDC9D747EC2D522D6368E7C1BB8F2DCFCA46B739E2EB60D465068E1F4816948A2A0C08C58ABE850610D58E9DDA03320962616E64636861696E",
                ],
                [
                    "0x43859A093DF6E5E786FF2E1A7D42B5454512E79DDAAB674E2EAE40649B0309D6",
                    "0x0D67C785A5695106B91A38974B1F7BC0AE0954F18C12A5AB184625A23E38D3AE",
                    27,
                    "0x6D0802115A0D00000000000022480A20",
                    "0x122408011220DDC9D747EC2D522D6368E7C1BB8F2DCFCA46B739E2EB60D465068E1F4816948A2A0B08C68ABE850610E58EC501320962616E64636861696E",
                ],
            ],
        )
        assert tx.status == 0


def test_bridge_relayBlock_invalid_signature_order(simplebridge):
    with brownie.reverts("INVALID_SIGNATURE_SIGNER_ORDER"):
        tx = simplebridge.relayBlock(
            [
                "0x94FE4A060FCF744C5BFCE1155CF1AB99B386F9170BC1C0105060994AEBEDE65C",
                "0x81A0E5D8922FA8C8FE948D9B4D5698FEFA77E52FB8DF370AE274C43230B4D669",
                "0x7920D562EC07A9979286FDCDA975F943D41D31974B01B8DC5B1B374878B194DA",
                "0xB1AA552EFF4C5CEDE334037AC62520E89AA76FA4326A4C56E9A92996C0BF7E26",
                "0x739AA168868729CA2139B3AC5A066BDEB8BF06A059C2FE35E9D7D65504E26F55",
            ],
            [
                "0x3F02642D9E70D5C1C493A4F732BFE9C9B95A4A42651703B816EDCFC8FADA5312",  # versionAndChainIdHash
                3418,  # height
                1622115652,  # timeSecond
                146102103,  # timeNanoSecond
                "0xE5A87E02ABE1B519CE5C57E8E35F033F5E707D368C6DF352EADFEB41FE69E3B2",  # lastBlockIDAndOther
                "0x6206F2FFDFBB93B83BD917B05B13CA59C12330268611242F5FD5734E67307915",  # nextValidatorHashAndConsensusHash
                "0x9FB9C7533CAF1D218DA3AF6D277F6B101C42E3C3B75D784242DA663604DD53C2",  # lastResultsHash
                "0x8A153906A4AFDFBF3AEA3F0AA4C4002A7F1B9FB0970200F828C8799DF424B00C",  # evidenceAndProposerHash
            ],
            [
                [
                    "0xDE2B93A4D1CD495ADD00C9E8D1A9BA5FB8D00D335C58254578D730E57DEF3E01",
                    "0x71A7BFBCDEECAB7E12BB8BACF50208AF78979F7BFD7F297F404E19842582E448",
                    27,
                    "0x6D0802115A0D00000000000022480A20",
                    "0x122408011220DDC9D747EC2D522D6368E7C1BB8F2DCFCA46B739E2EB60D465068E1F4816948A2A0B08C68ABE850610A1DE9202320962616E64636861696E",
                ],
                [
                    "0x9B27A5994109DC23F315FFB58B1B37E1FBAD2DD675F580073956581AD029446C",
                    "0x042811200893728CF01A56CCFE68F71284F54C973DFE5734EC554760B19DEDB4",
                    27,
                    "0x6E0802115A0D00000000000022480A20",
                    "0x122408011220DDC9D747EC2D522D6368E7C1BB8F2DCFCA46B739E2EB60D465068E1F4816948A2A0C08C58ABE850610D58E9DDA03320962616E64636861696E",
                ],
                [
                    "0x43859A093DF6E5E786FF2E1A7D42B5454512E79DDAAB674E2EAE40649B0309D6",
                    "0x0D67C785A5695106B91A38974B1F7BC0AE0954F18C12A5AB184625A23E38D3AE",
                    27,
                    "0x6D0802115A0D00000000000022480A20",
                    "0x122408011220DDC9D747EC2D522D6368E7C1BB8F2DCFCA46B739E2EB60D465068E1F4816948A2A0B08C68ABE850610E58EC501320962616E64636861696E",
                ],
                [
                    "0x166EB606586E9D932A468F52545A66882DCBF751D974D369FCD058D5B87D2C2F",
                    "0x02051DFCE46A45188E4042B007E0F6A9C265F3AAFDAA35F6EBB7586B0BB395C7",
                    27,
                    "0x6D0802115A0D00000000000022480A20",
                    "0x122408011220DDC9D747EC2D522D6368E7C1BB8F2DCFCA46B739E2EB60D465068E1F4816948A2A0B08C68ABE850610CAE7FA02320962616E64636861696E",
                ],
            ],
        )
        assert tx.status == 0
